// This file is generated by holgen. Do not modify manually.
#pragma once

#include "../holgen.h"
#include <deque>
#include <filesystem>
#include "DotNetModule.h"
#include "coreclr_delegates.h"
#include "hostfxr.h"
#include "nethost.h"

#ifdef WINDOWS
#include <Windows.h>
#else
#include <dlfcn.h>
#endif
namespace holgen_blackbox_csharp {
class DotNetHost {
public:
  ~DotNetHost();
  void Initialize(const std::filesystem::path &pathToBaseModule);
  DotNetModule &LoadCustomDotNetModule(const std::filesystem::path &modulePath);
private:
  void (*mLoadModule)(const char *absolutePath) = nullptr;
  void *LoadFunction(void *module, const char *name) const;
  void *LoadLibrary(const char_t *path) const;
  void FreeLibrary(void *h) const;
  void *LoadDelegate(hostfxr_delegate_type delegateType) const;
  void LoadBaseModule(const std::filesystem::path &modulePath);
  void InitializeHolgen();
  void *mHostfxrLibHandle = nullptr;
  hostfxr_initialize_for_runtime_config_fn mHostfxr_initialize_for_runtime_config = nullptr;
  hostfxr_get_runtime_delegate_fn mHostfxr_get_runtime_delegate = nullptr;
  hostfxr_close_fn mHostfxr_close = nullptr;
  hostfxr_handle mHostfxrHandle = nullptr;
  load_assembly_fn mHostfxrDelegate_load_assembly = nullptr;
  get_function_pointer_fn mHostfxrDelegate_get_function_pointer = nullptr;
  std::deque<DotNetModule> mDotNetModules;
};
}
